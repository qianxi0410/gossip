<!DOCTYPE html><html lang="zh-CN" id="html"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>qianxi0410<!-- -->&#x27;s website</title><meta name="next-head-count" content="3"/><link rel="shortcut icon" href="./favicon.ico"/><link rel="preload" href="/gossip/_next/static/css/35ef20406a171349.css" as="style"/><link rel="stylesheet" href="/gossip/_next/static/css/35ef20406a171349.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/gossip/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/gossip/_next/static/chunks/webpack-82d33c59ae4f941d.js" defer=""></script><script src="/gossip/_next/static/chunks/framework-cd882fbc9dfcb48f.js" defer=""></script><script src="/gossip/_next/static/chunks/main-af23d43202e61892.js" defer=""></script><script src="/gossip/_next/static/chunks/pages/_app-e6bfca3edf7dd94e.js" defer=""></script><script src="/gossip/_next/static/chunks/123-5c60f0a2b119185a.js" defer=""></script><script src="/gossip/_next/static/chunks/254-114351c91b4e4b84.js" defer=""></script><script src="/gossip/_next/static/chunks/3-0ae1e85a07c8f5e4.js" defer=""></script><script src="/gossip/_next/static/chunks/pages/post/%5Bid%5D-3033242d92667d25.js" defer=""></script><script src="/gossip/_next/static/TXOL9bc9IqdQuBJ3gumJX/_buildManifest.js" defer=""></script><script src="/gossip/_next/static/TXOL9bc9IqdQuBJ3gumJX/_ssgManifest.js" defer=""></script></head><body class="dark:bg-black bg-slate-50"><div id="__next"><script>!function(){try{var d=document.documentElement,n='data-theme',s='setAttribute';var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';d[s](n,'dark')}else{d.style.colorScheme = 'light';d[s](n,'light')}}else if(e){d[s](n,e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><div class="flex flex-col h-screen container w-full md:w-3/4 xl:w-1/2"><header><div class="my-10 flex self-center flex-row justify-between"><div class="flex self-center flex-row justify-between"><a class="md:text-2xl text-xl cursor-pointer hover:underline underline-offset-4 italic font-en" href="/gossip">cd ..</a></div><div class="self-center text-sm sm:text-lg"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="2em" height="2em" viewBox="0 0 24 24" class="cursor-pointer"><path fill="currentColor" d="M12 5q-.425 0-.712-.288Q11 4.425 11 4V2q0-.425.288-.713Q11.575 1 12 1t.713.287Q13 1.575 13 2v2q0 .425-.287.712Q12.425 5 12 5Zm4.95 2.05q-.275-.275-.275-.688q0-.412.275-.712l1.4-1.425q.3-.3.712-.3q.413 0 .713.3q.275.275.275.7q0 .425-.275.7L18.35 7.05q-.275.275-.7.275q-.425 0-.7-.275ZM20 13q-.425 0-.712-.288Q19 12.425 19 12t.288-.713Q19.575 11 20 11h2q.425 0 .712.287q.288.288.288.713t-.288.712Q22.425 13 22 13Zm-8 10q-.425 0-.712-.288Q11 22.425 11 22v-2q0-.425.288-.712Q11.575 19 12 19t.713.288Q13 19.575 13 20v2q0 .425-.287.712Q12.425 23 12 23ZM5.65 7.05l-1.425-1.4q-.3-.3-.3-.725t.3-.7q.275-.275.7-.275q.425 0 .7.275L7.05 5.65q.275.275.275.7q0 .425-.275.7q-.3.275-.7.275q-.4 0-.7-.275Zm12.7 12.725l-1.4-1.425q-.275-.3-.275-.712q0-.413.275-.688q.275-.275.688-.275q.412 0 .712.275l1.425 1.4q.3.275.287.7q-.012.425-.287.725q-.3.3-.725.3t-.7-.3ZM2 13q-.425 0-.712-.288Q1 12.425 1 12t.288-.713Q1.575 11 2 11h2q.425 0 .713.287Q5 11.575 5 12t-.287.712Q4.425 13 4 13Zm2.225 6.775q-.275-.275-.275-.7q0-.425.275-.7L5.65 16.95q.275-.275.688-.275q.412 0 .712.275q.3.3.3.713q0 .412-.3.712l-1.4 1.4q-.3.3-.725.3t-.7-.3ZM12 18q-2.5 0-4.25-1.75T6 12q0-2.5 1.75-4.25T12 6q2.5 0 4.25 1.75T18 12q0 2.5-1.75 4.25T12 18Zm0-2q1.65 0 2.825-1.175Q16 13.65 16 12q0-1.65-1.175-2.825Q13.65 8 12 8q-1.65 0-2.825 1.175Q8 10.35 8 12q0 1.65 1.175 2.825Q10.35 16 12 16Z"></path></svg></div></div></header><main class="grow"><div><div class="flex flex-col mb-5"><div class="text-3xl sm:text-5xl font-normal dark:text-gray-200">可扩展哈希</div><div class="sm:text-xl text-lg mt-3 dark:text-gray-400"><span>12月3日</span> / <span>12月3日</span></div></div><br/><div class="font-normal"><h2 class="sm:text-3xl text-2xl mt-12 mb-6 dark:text-white font-medium">基本概念</h2>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300"><a href="https://en.wikipedia.org/wiki/Extendible_hashing" node="[object Object]" class="text-blue-500 hover:text-blue-800 after:content-[&#x27;_↗&#x27;] transition-colors duration-200">可扩展哈希</a> 是一种动态散列方案，其中的目录和桶被用来散列数据。
相较于静态哈希来说，可扩展哈希的优势在于，在扩容的时候，<strong node="[object Object]" class="font-bold dark:text-gray-100">不需要重新散列所有的数据，只需要重新散列一部分数据即可</strong>。</p>
<blockquote node="[object Object]" class="border-l-4 pl-4 border-gray-300 dark:border-gray-600 rounded-l-sm italic my-4">
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">静态哈希不等于不能扩容，只是扩容的时候需要重新散列所有的数据，并且需要重新寻找一个散列函数。</p>
</blockquote>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">可扩展 hash 的大致架构如下图所示：</p>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300"><img src="https://user-images.githubusercontent.com/55543743/205441868-9f312eae-0959-4905-8685-97cd0ffcff9c.png" class="w-11/12 mx-auto rounded-lg shadow-xl" loading="lazy" alt="可扩展hash架构"/></p>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">其中几个概念：</p>
<ul depth="0" node="[object Object]" class="sm:text-xl text-lg list-disc pl-5 dark:text-gray-300">
<li class="ml-2">目录(direcotory)：用来存储桶指针的数组，其中目录的大小为 2^全局深度，全局深度初始为 1，每次扩容时，全局深度加 1，即目录大小翻倍。这里需要注意，目录中会有多个指针指向同一个桶。</li>
<li class="ml-2">桶(bucket)： 用来存储数据的数组，每个桶的大小<strong node="[object Object]" class="font-bold dark:text-gray-100">固定</strong>，由参数进行指定，局部深度初始为 1，每次分裂时，该桶局部深度加 1。</li>
<li class="ml-2">全局深度(global depth)： 用来确定目录的大小，此外，全局深度还用来确定数据的散列地址。例如，全局深度为 1 时，数据的散列地址为 0 或 1，全局深度为 2 时，数据的散列地址为 00、01、10、11。</li>
<li class="ml-2">局部深度(local depth)：局部深度用来确定在桶溢出时候进行的操作：当局部深度小于全局深度时，进行桶的分裂，且桶的局部深度加 1；当局部深度等于全局深度时，进行目录的扩容和桶的分裂，且全局深度和局部深度都加 1。指向当前桶的指针的个数等于 2^(全局深度 - 局部深度)。</li>
<li class="ml-2">桶分裂：当桶溢出时，将桶中的数据重新散列到旧的桶和新的桶中。例如桶 A 已满，且 A 的局部深度为 1，溢出时，创建桶 A*，局部深度为 2，且将桶 A 的深度也改为 2。<del node="[object Object]" class="dark:text-gray-400">然后将桶 A 中的数据重新散列到桶 A 和桶 A*中</del>。 这里更好的说法是，将桶 A 的数据进行重新散列。且散列的数据只会落在桶 A 和桶 A*中，而不会落在其他桶中。</li>
<li class="ml-2">目录扩容：当全局深度增加时候，需要对目录进行扩容，即将目录的大小翻倍。且将新增加的目录的桶指针指向合适的桶。例如，当全局深度从 1 增加到 2 时，需要将目录的大小从 2 增加到 4，且将目录的第 3 个和第 4 个指针指向对应的桶（对应关系为: 将该目录项的索引的最高位的 1 替换为 0 之后的目录所指向的桶），第 3 个目录的指针则应该指向为第 1 个目录指针所指向的桶，而第 4 个目录指针则指向第 2 个目录指针所指向的桶。</li>
</ul>
<h2 class="sm:text-3xl text-2xl mt-12 mb-6 dark:text-white font-medium">流程</h2>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">流程如下所示：</p>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300"><img src="https://user-images.githubusercontent.com/55543743/205441887-ca3ff3e3-4348-4503-8c8f-0b72a1ca45b1.png" class="w-11/12 mx-auto rounded-lg shadow-xl" loading="lazy" alt="流程"/></p>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">找到对应的桶之后，可以进行查找/删除/增加等操作。</p>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">举个例子：</p>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">此时的状态为：全局深度 1，局部深度 1，key 为&quot;qianxi&quot;, hash(key) = 114514。</p>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">按照流程，先对 key = qianxi 应用 hash 函数，得到 114514。然后，寻找对应的目录索引 dir_index = (114514 &amp; ((1 &lt;&lt; 全局深度) - 1)) = 0，得到索引 0，在按照目录中所存放的桶指针找到的目录项 0 所指向的桶，随后进行对应的操作。</p>
<h2 class="sm:text-3xl text-2xl mt-12 mb-6 dark:text-white font-medium">举个栗子</h2>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">查找和删除操作这里都不讲，着重讲讲插入操作。</p>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">预设：桶的大小为 2，hash(key) = key，待插入的 key 为 1-8。</p>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">首先的初始情况为：</p>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300"><img src="https://user-images.githubusercontent.com/55543743/205441902-83c6e4ed-bda9-49f8-8d21-e9f805f0be79.png" class="w-11/12 mx-auto rounded-lg shadow-xl" loading="lazy" alt="初始情况"/></p>
<ol depth="0" node="[object Object]" class="sm:text-xl text-lg my-4 list-decimal pl-10 dark:text-gray-300">
<li class="ml-2">插入 1，hash(1) = 1，dir_index = 1 &amp; 1 = 1，所以插入到桶 1 中。</li>
<li class="ml-2">插入 2，hash(2) = 10，dir_index = 10 &amp; 1 = 0，所以插入到桶 0 中。</li>
<li class="ml-2">插入 3，hash(3) = 11，dir_index = 11 &amp; 1 = 1，所以插入到桶 1 中。</li>
<li class="ml-2">插入 4，hash(4) = 100，dir_index = 100 &amp; 1 = 0，所以插入到桶 0 中。</li>
</ol>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">此时，桶 0 和桶 1 都已满，状态如下：</p>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300"><img src="https://user-images.githubusercontent.com/55543743/205441908-11412e98-315c-47ba-8566-7ada36f13b06.png" class="w-11/12 mx-auto rounded-lg shadow-xl" loading="lazy" alt="阶段1"/></p>
<ol start="5" depth="0" node="[object Object]" class="sm:text-xl text-lg my-4 list-decimal pl-10 dark:text-gray-300">
<li class="ml-2">插入 5，hash(5) = 101，dir_index = 101 &amp; 1 = 1，所以插入到桶 1 中。</li>
</ol>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">问题来了，桶 1 已经满了（桶的大小固定且在这里设定为 2），而且此时桶 1 的局部深度为 1，全局深度也为 1，这就代表着，没有多余的指针指向桶 1，所以你需要首先对目录进行扩容，扩容后的目录如下：</p>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300"><img src="https://user-images.githubusercontent.com/55543743/205441912-fa3b0bab-2833-4c82-87c3-b4ebb88ed263.png" class="w-11/12 mx-auto rounded-lg shadow-xl" loading="lazy" alt="第一次扩容"/></p>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">注意到，此时的全局深度增加 1 之后为 2，而且，扩容增加之后的目录指向了桶 0 和桶 1。还记得为什么吗，上文说到，新增目录项所指向的内容为将其所索引的最高为的 1 换成 0 之后的索引所对应的目录项所指向的内容。所以，此时，新增的目录项 2 所指向的内容为桶 0，新增的目录项 3 所指向的内容为桶 1。</p>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">此时，全局深度为 2，局部深度为 1，key 为 5，hash(key) = 5， 插入到桶 1 中。</p>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">但是，扩容之后，桶 1 的局部深度 1 小于全局深度 2，这就意味着，有不止一个指针指向桶 1，所以，你仅仅需要对桶 1 进行分裂。首先，需要找到另一个指向桶 1 的目录项，这里就是目录项 3（逆向操作，将索引 1 的最高位由 0 变为 1 即可），将其指向一个新的空桶，然后，对目录项 1 所指向的桶进行分裂（别忘了加上新增的元素 5），即对 1、3、5 这些元素重新进行哈希：</p>
<ul depth="0" node="[object Object]" class="sm:text-xl text-lg list-disc pl-5 dark:text-gray-300">
<li class="ml-2">插入 1，hash(1) = 1, dir_index = 1 &amp; 11 = 1,所以插入到桶 01 中。</li>
<li class="ml-2">插入 3，hash(3) = 11, dir_index = 11 &amp; 11 = 11 ，所以插入到桶 11 中。</li>
<li class="ml-2">插入 5，hash(5) = 101, dir_index = 101 &amp; 11 = 01 ，所以插入到桶 01 中。</li>
</ul>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">这样，就完成了桶的分裂，且没有桶溢出。</p>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">分裂之后的状态如下：</p>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300"><img src="https://user-images.githubusercontent.com/55543743/205441932-3653da0b-bb6e-4a95-afcc-5152178da704.png" class="w-11/12 mx-auto rounded-lg shadow-xl" loading="lazy" alt="分裂之后的状态"/></p>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">别忘了对新的桶和分裂的桶进行局部深度的更新。</p>
<ol depth="0" node="[object Object]" class="sm:text-xl text-lg my-4 list-decimal pl-10 dark:text-gray-300">
<li class="ml-2">插入 6，hash(6) = 110，dir_index = 110 &amp; 11 = 10，所以插入到桶 10 中。</li>
</ol>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">注意，此时，桶 10 的局部深度为 1，全局深度为 2，所以，此时只需要进行桶分裂，不需要对目录进行扩容。</p>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">所以步骤如上，对 2、4、6 进行重新哈希：</p>
<ul depth="0" node="[object Object]" class="sm:text-xl text-lg list-disc pl-5 dark:text-gray-300">
<li class="ml-2">插入 2，hash(2) = 10，dir_index = 10 &amp; 11 = 10，所以插入到桶 10 中。</li>
<li class="ml-2">插入 4，hash(4) = 100，dir_index = 100 &amp; 11 = 00，所以插入到桶 00 中。</li>
<li class="ml-2">插入 6，hash(6) = 110，dir_index = 110 &amp; 11 = 10，所以插入到桶 10 中。</li>
</ul>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">插入完成，且更新对应的局部深度之后的状态如下：</p>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300"><img src="https://user-images.githubusercontent.com/55543743/205441945-e06f4304-243a-4fff-a2be-a5cb35cbdd73.png" class="w-11/12 mx-auto rounded-lg shadow-xl" loading="lazy" alt="第二次分裂"/></p>
<ol start="7" depth="0" node="[object Object]" class="sm:text-xl text-lg my-4 list-decimal pl-10 dark:text-gray-300">
<li class="ml-2">插入 7，hash(7) = 111，dir_index = 111 &amp; 11 = 11，所以插入到桶 11 中。</li>
<li class="ml-2">插入 8，hash(8) = 1000，dir_index = 1000 &amp; 11 = 00，所以插入到桶 00 中。</li>
</ol>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300">全部插入完成之后的状态如下：</p>
<p node="[object Object]" class="sm:text-xl text-lg mt-4 dark:text-gray-300"><img src="https://user-images.githubusercontent.com/55543743/205441950-78907d24-8301-4489-9031-3d153479a007.png" class="w-11/12 mx-auto rounded-lg shadow-xl" loading="lazy" alt="全部插入完成之后的状态"/></p></div><br/><div></div><a class="float-right mt-10 sm:text-2xl text-xl text-gray-500 hover:text-black hover:underline hover:underline-offset-4 transition-all dark:text-gray-400 dark:hover:text-gray-100" href="/gossip">cd ..</a></div></main><footer class="container mx-auto text-center text-gray-700 dark:text-gray-400"><div class="flex flex-row justify-center mb-5 space-x-5"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.8em" height="1.8em" viewBox="0 0 24 24" class="cursor-pointer"><path fill="currentColor" fill-rule="evenodd" d="M3.5 3.25a.75.75 0 0 1 .75-.75C14.053 2.5 22 10.447 22 20.25a.75.75 0 0 1-1.5 0C20.5 11.275 13.225 4 4.25 4a.75.75 0 0 1-.75-.75zM3.5 19a2 2 0 1 1 4 0a2 2 0 0 1-4 0zm.75-9.5a.75.75 0 0 0 0 1.5a9.25 9.25 0 0 1 9.25 9.25a.75.75 0 0 0 1.5 0C15 14.313 10.187 9.5 4.25 9.5z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.8em" height="1.8em" viewBox="0 0 24 24" class="cursor-pointer"><path fill="currentColor" d="M4 20q-.825 0-1.412-.587Q2 18.825 2 18V6q0-.825.588-1.412Q3.175 4 4 4h16q.825 0 1.413.588Q22 5.175 22 6v12q0 .825-.587 1.413Q20.825 20 20 20ZM20 8l-7.475 4.675q-.125.075-.263.112q-.137.038-.262.038t-.262-.038q-.138-.037-.263-.112L4 8v10h16Zm-8 3l8-5H4ZM4 8v.25v-1.475v.025V6v.8v-.013V8.25V8v10Z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.8em" height="1.8em" cursor="pointer" viewBox="0 0 16 16"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5.75 14.25s-.5-2 .5-3c0 0-2 0-3.5-1.5s-1-4.5 0-5.5c-.5-1.5.5-2.5.5-2.5s1.5 0 2.5 1c1-.5 3.5-.5 4.5 0c1-1 2.5-1 2.5-1s1 1 .5 2.5c1 1 1.5 4 0 5.5s-3.5 1.5-3.5 1.5c1 1 .5 3 .5 3m-5-.5c-1.5.5-3-.5-3.5-1"></path></svg></div><div class="mb-10 font-en">©<!-- -->2022<!-- -->. All rights reserved by <a href="https://github.com/qianxi0410" class="text-blue-500 hover:text-blue-900 transition-colors duration-300">qianxi0410</a>. Powered by <a href="https://github.com/qianxi0410/gossip" class="text-blue-500 hover:text-blue-900 transition-colors duration-300">Gossip</a>.</div></footer><div class="bottom-10 right-10 cursor-pointer fixed hidden lg:block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.8em" height="1.8em" viewBox="0 0 24 24" class="opacity-0 duration-700 transition-opacity ease-in-out"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 19h14a2 2 0 0 0 1.84-2.75L13.74 4a2 2 0 0 0-3.5 0l-7.1 12.25A2 2 0 0 0 4.89 19"></path></svg></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"id":95,"title":"可扩展哈希","created_at":"2022-12-03T12:56:29Z","updated_at":"2022-12-03T13:06:15Z","content":"## 基本概念\r\n\r\n[可扩展哈希](https://en.wikipedia.org/wiki/Extendible_hashing) 是一种动态散列方案，其中的目录和桶被用来散列数据。\r\n相较于静态哈希来说，可扩展哈希的优势在于，在扩容的时候，**不需要重新散列所有的数据，只需要重新散列一部分数据即可**。\r\n\r\n\u003e 静态哈希不等于不能扩容，只是扩容的时候需要重新散列所有的数据，并且需要重新寻找一个散列函数。\r\n\r\n可扩展 hash 的大致架构如下图所示：\r\n\r\n![可扩展hash架构](https://user-images.githubusercontent.com/55543743/205441868-9f312eae-0959-4905-8685-97cd0ffcff9c.png)\r\n\r\n其中几个概念：\r\n\r\n- 目录(direcotory)：用来存储桶指针的数组，其中目录的大小为 2^全局深度，全局深度初始为 1，每次扩容时，全局深度加 1，即目录大小翻倍。这里需要注意，目录中会有多个指针指向同一个桶。\r\n- 桶(bucket)： 用来存储数据的数组，每个桶的大小**固定**，由参数进行指定，局部深度初始为 1，每次分裂时，该桶局部深度加 1。\r\n- 全局深度(global depth)： 用来确定目录的大小，此外，全局深度还用来确定数据的散列地址。例如，全局深度为 1 时，数据的散列地址为 0 或 1，全局深度为 2 时，数据的散列地址为 00、01、10、11。\r\n- 局部深度(local depth)：局部深度用来确定在桶溢出时候进行的操作：当局部深度小于全局深度时，进行桶的分裂，且桶的局部深度加 1；当局部深度等于全局深度时，进行目录的扩容和桶的分裂，且全局深度和局部深度都加 1。指向当前桶的指针的个数等于 2^(全局深度 - 局部深度)。\r\n- 桶分裂：当桶溢出时，将桶中的数据重新散列到旧的桶和新的桶中。例如桶 A 已满，且 A 的局部深度为 1，溢出时，创建桶 A\\*，局部深度为 2，且将桶 A 的深度也改为 2。~~然后将桶 A 中的数据重新散列到桶 A 和桶 A\\*中~~。 这里更好的说法是，将桶 A 的数据进行重新散列。且散列的数据只会落在桶 A 和桶 A\\*中，而不会落在其他桶中。\r\n- 目录扩容：当全局深度增加时候，需要对目录进行扩容，即将目录的大小翻倍。且将新增加的目录的桶指针指向合适的桶。例如，当全局深度从 1 增加到 2 时，需要将目录的大小从 2 增加到 4，且将目录的第 3 个和第 4 个指针指向对应的桶（对应关系为: 将该目录项的索引的最高位的 1 替换为 0 之后的目录所指向的桶），第 3 个目录的指针则应该指向为第 1 个目录指针所指向的桶，而第 4 个目录指针则指向第 2 个目录指针所指向的桶。\r\n\r\n## 流程\r\n\r\n流程如下所示：\r\n\r\n![流程](https://user-images.githubusercontent.com/55543743/205441887-ca3ff3e3-4348-4503-8c8f-0b72a1ca45b1.png)\r\n\r\n找到对应的桶之后，可以进行查找/删除/增加等操作。\r\n\r\n举个例子：\r\n\r\n此时的状态为：全局深度 1，局部深度 1，key 为\"qianxi\", hash(key) = 114514。\r\n\r\n按照流程，先对 key = qianxi 应用 hash 函数，得到 114514。然后，寻找对应的目录索引 dir_index = (114514 \u0026 ((1 \u003c\u003c 全局深度) - 1)) = 0，得到索引 0，在按照目录中所存放的桶指针找到的目录项 0 所指向的桶，随后进行对应的操作。\r\n\r\n## 举个栗子\r\n\r\n查找和删除操作这里都不讲，着重讲讲插入操作。\r\n\r\n预设：桶的大小为 2，hash(key) = key，待插入的 key 为 1-8。\r\n\r\n首先的初始情况为：\r\n\r\n![初始情况](https://user-images.githubusercontent.com/55543743/205441902-83c6e4ed-bda9-49f8-8d21-e9f805f0be79.png)\r\n\r\n1. 插入 1，hash(1) = 1，dir_index = 1 \u0026 1 = 1，所以插入到桶 1 中。\r\n2. 插入 2，hash(2) = 10，dir_index = 10 \u0026 1 = 0，所以插入到桶 0 中。\r\n3. 插入 3，hash(3) = 11，dir_index = 11 \u0026 1 = 1，所以插入到桶 1 中。\r\n4. 插入 4，hash(4) = 100，dir_index = 100 \u0026 1 = 0，所以插入到桶 0 中。\r\n\r\n此时，桶 0 和桶 1 都已满，状态如下：\r\n\r\n![阶段1](https://user-images.githubusercontent.com/55543743/205441908-11412e98-315c-47ba-8566-7ada36f13b06.png)\r\n\r\n5. 插入 5，hash(5) = 101，dir_index = 101 \u0026 1 = 1，所以插入到桶 1 中。\r\n\r\n问题来了，桶 1 已经满了（桶的大小固定且在这里设定为 2），而且此时桶 1 的局部深度为 1，全局深度也为 1，这就代表着，没有多余的指针指向桶 1，所以你需要首先对目录进行扩容，扩容后的目录如下：\r\n\r\n![第一次扩容](https://user-images.githubusercontent.com/55543743/205441912-fa3b0bab-2833-4c82-87c3-b4ebb88ed263.png)\r\n\r\n注意到，此时的全局深度增加 1 之后为 2，而且，扩容增加之后的目录指向了桶 0 和桶 1。还记得为什么吗，上文说到，新增目录项所指向的内容为将其所索引的最高为的 1 换成 0 之后的索引所对应的目录项所指向的内容。所以，此时，新增的目录项 2 所指向的内容为桶 0，新增的目录项 3 所指向的内容为桶 1。\r\n\r\n此时，全局深度为 2，局部深度为 1，key 为 5，hash(key) = 5， 插入到桶 1 中。\r\n\r\n但是，扩容之后，桶 1 的局部深度 1 小于全局深度 2，这就意味着，有不止一个指针指向桶 1，所以，你仅仅需要对桶 1 进行分裂。首先，需要找到另一个指向桶 1 的目录项，这里就是目录项 3（逆向操作，将索引 1 的最高位由 0 变为 1 即可），将其指向一个新的空桶，然后，对目录项 1 所指向的桶进行分裂（别忘了加上新增的元素 5），即对 1、3、5 这些元素重新进行哈希：\r\n\r\n- 插入 1，hash(1) = 1, dir_index = 1 \u0026 11 = 1,所以插入到桶 01 中。\r\n- 插入 3，hash(3) = 11, dir_index = 11 \u0026 11 = 11 ，所以插入到桶 11 中。\r\n- 插入 5，hash(5) = 101, dir_index = 101 \u0026 11 = 01 ，所以插入到桶 01 中。\r\n\r\n这样，就完成了桶的分裂，且没有桶溢出。\r\n\r\n分裂之后的状态如下：\r\n\r\n![分裂之后的状态](https://user-images.githubusercontent.com/55543743/205441932-3653da0b-bb6e-4a95-afcc-5152178da704.png)\r\n\r\n别忘了对新的桶和分裂的桶进行局部深度的更新。\r\n\r\n1. 插入 6，hash(6) = 110，dir_index = 110 \u0026 11 = 10，所以插入到桶 10 中。\r\n\r\n注意，此时，桶 10 的局部深度为 1，全局深度为 2，所以，此时只需要进行桶分裂，不需要对目录进行扩容。\r\n\r\n所以步骤如上，对 2、4、6 进行重新哈希：\r\n\r\n- 插入 2，hash(2) = 10，dir_index = 10 \u0026 11 = 10，所以插入到桶 10 中。\r\n- 插入 4，hash(4) = 100，dir_index = 100 \u0026 11 = 00，所以插入到桶 00 中。\r\n- 插入 6，hash(6) = 110，dir_index = 110 \u0026 11 = 10，所以插入到桶 10 中。\r\n\r\n插入完成，且更新对应的局部深度之后的状态如下：\r\n\r\n![第二次分裂](https://user-images.githubusercontent.com/55543743/205441945-e06f4304-243a-4fff-a2be-a5cb35cbdd73.png)\r\n\r\n7. 插入 7，hash(7) = 111，dir_index = 111 \u0026 11 = 11，所以插入到桶 11 中。\r\n8. 插入 8，hash(8) = 1000，dir_index = 1000 \u0026 11 = 00，所以插入到桶 00 中。\r\n\r\n全部插入完成之后的状态如下：\r\n\r\n![全部插入完成之后的状态](https://user-images.githubusercontent.com/55543743/205441950-78907d24-8301-4489-9031-3d153479a007.png)\r\n\r\n","author":"qianxi0410","reactions":{"url":"https://api.github.com/repos/qianxi0410/gossip/issues/95/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"labels":["published","数据结构"]}},"__N_SSG":true},"page":"/post/[id]","query":{"id":"可扩展哈希"},"buildId":"TXOL9bc9IqdQuBJ3gumJX","assetPrefix":"/gossip","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>